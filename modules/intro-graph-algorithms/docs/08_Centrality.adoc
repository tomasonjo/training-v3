= Centrality
:slug: 00-gdsaa-about-this-course
:doctype: book
:toc: left
:toclevels: 4
:imagesdir: ../images
:module-next-title: Setup and Cypher Refresher

== Centrality algorithms

Determines the importance of distinct nodes in the network.

Developed for distinct uses or types of importance. 


== PageRank

Measures the transitive (directional) influence of nodes and considers the influence of neighbors and their neighbors.

Dampening factor: Probability that the end user will click through a link. Default value used by the Neo4j graph algorithm is .85. You must test the dampening factor as it will change the outcome. Note that Spark uses an inverse dampening factor (.15).

An example of this type of influence might be having the ear of a general that considers you very credible will likely make you more powerful than being really popular with your fellow foot soldiers.
PageRank measure importance in comparison to other nodes using an iterative process to update ranks.

image::pagerank-step-1.png[PageRank step 1,width=500, align=center]

image::pagerank-step-2.png[PageRank step 2,width=500, align=center]

image::pagerank-step-3.png[PageRank step 3,width=500, align=center]


Twitter uses Personalized PageRank to present users with recommendations of other accounts that they may wish to follow. The algorithm is run over a graph that contains shared interests and common connections. Their approach is described in more detail in WTF: The Who to Follow Service at Twitter. 
PageRank has been used to rank public spaces or streets, predicting traffic flow and human movement in these areas. The algorithm is run over a graph of road intersections, where the PageRank score reflects the tendency of people to park, or end their journey, on each street. This is described in more detail in Self- organized Natural Roads for Predicting Traffic Flow: A Sensitivity Study. 17 
PageRank is also used as part of an anomaly and fraud detection system in the healthcare and insurance industries. It helps reveal doctors or providers that are behaving in an unusual manner and then feeds the score into a machine learning algorithm. 


Find the most influential features for extraction in machine learning and rank text for entity relevance in natural language processing.

Use when:

You are looking for broad influence over a network.

There are many domain specific variations for differing analysis, e.g. Personalized PageRank for personalized recommendations.

Recommendations
Who To follow with
personalized PR

Fraud Detection 
Feature engineering for machine learning

It starts by assigning values to nodes as 1/n (n is the total number of nodes linked to) and value to relationships as that nodes value / # of it’s outgoing links.
It then starts to update values for nodes as the sum of the prior in-link values. The relationship values are updated the same way they were initially assigned.
PageRank then continues to update values until an iterate value is reached.

=== Example: PageRank

MERGE (home:Page {name:"Home"})
MERGE (about:Page {name:"About"})
MERGE (product:Page {name:"Product"})
MERGE (links:Page {name:"Links"})
MERGE (a:Page {name:"Site A"})
MERGE (b:Page {name:"Site B"})
MERGE (c:Page {name:"Site C"})
MERGE (d:Page {name:"Site D"})
MERGE (home)-[:LINKS]->(about)
MERGE (about)-[:LINKS]->(home)
MERGE (product)-[:LINKS]->(home)
MERGE (home)-[:LINKS]->(product)
MERGE (links)-[:LINKS]->(home)
MERGE (home)-[:LINKS]->(links)
MERGE (links)-[:LINKS]->(a)
MERGE (a)-[:LINKS]->(home)
MERGE (links)-[:LINKS]->(b)
MERGE (b)-[:LINKS]->(home)
MERGE (links)-[:LINKS]->(c)
MERGE (c)-[:LINKS]->(home)
MERGE (links)-[:LINKS]->(d)
MERGE (d)-[:LINKS]->(home)

CALL algo.pageRank.stream("Page", "LINKS",
{iterations:20})
YIELD nodeId, score
MATCH (node) WHERE id(node) = nodeId
RETURN node.name AS page,score
ORDER BY score DESC


This code uses the default dampening factor of .85

=== Example: Personalized PageRank

MATCH (p:Page)
WHERE p.name = 'Site A' OR p.name = 'Site C'
with collect(p) AS sites
CALL algo.pageRank.stream("Page", "LINKS",
{iterations:20, sourceNodes: sites})
YIELD nodeId, score
MATCH (node) WHERE id(node) = nodeId
RETURN node.name AS page,score
ORDER BY score DESC

=== Exercise: PageRank

In NEuler:
Perform the PageRank analysis on different seasons of GOT.
In Neo4j Browser:
:play intro-graph-algos-exercises  (PageRank)


== Betweenness centrality

image::betweenness-centrality.png[Betweenness centrality,width=500, align=center]


The Betweenness Centrality algorithm first calculates the shortest (weighted) path between every pair of nodes in a connected graph. Each node receives a score, based on the number of these shortest paths that pass through the node. The more shortest paths that a node lies on, the higher its score. 

Randomized- Approximate Brandes (Random or degree based selection)

On tip - Therefore, it doesn’t give us a perfect view of the most influential nodes in a graph, but rather a good representation. 

The sum of the % shortest paths that pass through a node, calculated by pairs.


Sometimes the most important cog in the system is not the one with the most overt power or the highest status. Sometimes it’s the middlemen that connect groups or the brokers with the most control over resources or the flow of information. Betweenness Centrality is a way of detecting the amount of influence a node has over the flow of information in a graph. It is typically used to find nodes that serve as a bridge from one part of a graph to another. 


Betweenness Centrality is used to identify influencers in various organizations. Powerful individuals are not necessarily in management positions, but can be found in “brokerage positions” using Betweeness Centrality. Removal of such influencers seriously destabilize the organization. This might be a welcome dis‐ ruption by law enforcement if the organization is criminal, or may be a disaster if a business loses key staff it never knew about. More details are found in Broker‐ age qualifications in ringing operations 11 by Carlo Morselli and Julie Roy. 
Betweeness Centrality uncovers key transfer points in networks such electrical grids. Counterintuitively, removal of specific bridges can actually improve overall robustness by “islanding” disturbances. Research details are included in Robust‐ ness of the European power grids under intentional attack 12 by Sol ́e R., Rosas- Casals M., Corominas-Murtral B., and Valverde S. 
Betweenness Centrality is also used to help microbloggers spread their reach on Twitter, with a recommendation engine for targeting influencers. This approach is described in Making Recommendations in a Microblog to Improve the Impact of a Focal User. 13 


Improve drug targeting by finding the control genes for specific diseases. – ALSO gluclose processing

Example uses:

Identify bridges.

Uncover control points.

Find bottlenecks and vulnerabilities.

=== Example: Betweenness Centrality

As we can see in the chart and in the visualization, Ned is of central importance in the graph for season 1. He has a centrality score of 780.

Note that in NEuler, in order for the nodes to provide the information you want to display, you must write the value to the graph. Here we have written betweenness to each node in the graph.

=== Example: Approximate Betweenness centrality

Betweenness centrality doesn’t scale well on large graphs - too many comparisons and you run out of memory
Sampling lets you calculate an approximate betweenness centrality
random sampling selects nodes randomly


degree sampling only calculates betweenness for graphs with more than the average number of edges

So when you’re using sampling, set the probability initially low and the depth to 1, then if that runs incrementally step up until you reach a threshold. 


=== Exercise: Betweenness centrality

In NEuler
View the closeness  and betweenness centrality scores for other GOT seasons and examine the paths in Neo4j Browser for these nodes.
Try some of the other centrality algorithms with the GOT data.
In Neo4j Browser:
:play intro-graph-algos-exercises  (Centrality)

