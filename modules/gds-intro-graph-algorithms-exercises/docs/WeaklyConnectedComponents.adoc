= Weakly Connected Components
:icons: font

== Weakly Connected Components (Preparations)

The database you start with should contain all of the data you loaded in the setup for this course.

This is what you should see when you click the database icon image:database-icon.png[].

image::LoadedDatabase.png[LoadedDatabase,width=150]

{nbsp} +

If you do not see this in your Neo4j Browser, you will need to perform the setup steps again.

The roads network should be projected in graph catalog as well.

This is what you should see when you execute the following query:

[source, cypher]
----
CALL gds.graph.list()
YIELD graphName
----

image::LoadedRoadGraph.png[LoadedDatabase,width=150]

If you do not see this in your Neo4j Browser, you will need to perform the graph catalog steps again.

== Weakly Connected Components (Overview)

In this exercise, you will gain some experience with writing Cypher for weakly connected graph algorithm using the European Roads dataset.


* *Part 1*: View the European Roads dataset schema.
* *Part 2*: Find all connected places, writing unionFind partition information to the graph.
* *Part 3*: Verify results of the weakly connected nodes execution.
* *Part 4*: Execute the weighted Weakly connected component algorithm


Go to the next page to start this exercise.

== Part 1: View the European Roads dataset schema. (Instructions)

The European Roads dataset contains *Place* nodes that are connected by the *EROAD* relationship. Write a query to view some of the nodes and relationships in this dataset. What are the properties?

== Part 1: View the European Roads dataset schema. (Solution)

The European Roads dataset contains *Place* nodes that are connected by the *EROAD* relationship. Write a query to view some of the nodes and relationships in this dataset. What are the properties?

Here is the solution code:

[source, cypher]
----
MATCH p=(:Place)-[:EROAD]-(:Place)
RETURN p LIMIT 10
----

The results returned should look like this:

[.thumb]
image::EX2.1.png[EX2.1,width=300]

{nbsp} +

The properties for a *Place* node are *name* and *countryCode*.

The properties for an *EROAD* relationship are *distance*, *road_number*, and *watercrossing*.

== Part 2: Find all weakly connected places, writing their weakly component information to the graph. (Instructions)

A  weakly connected node is one where there is a path in any direction from one node another node in the graph.
Write the Cypher code to find all weakly connected *Place* nodes and set the property, *wcc_component* for each node based upon the result of the algorithm.

*Hint*: You will use `gds.wcc.write`.

== Part 2: Find all connected places, writing their weakly component information to the graph. (Solution)

A  weakly connected node is one where there is a path in any direction from one node another node in the graph.
Write the Cypher code to find all weakly connected *Place* nodes and set the property, *wcc_component* for each node based upon the result of the algorithm.

*Hint*: You will use `gds.wcc.write`.

Here is the solution code:

[source, cypher]
----
CALL gds.wcc.write('roads',{
    writeProperty:"component_wcc"})
----

The results returned should look like this:

[.thumb]
image::EX2.4.png[EX2.4,width=400]


== Part 3: Verify results of the connected  nodes execution. (Instructions)

Write a query to return all *wcc_component* values in the graph containing *Place* nodes.
For each distinct component value, return the list of places.

== Part 3: Verify results of the connected  nodes execution. (Solution)

Write a query to return all *wcc_component* values in the graph containing *Place* nodes.
For each distinct component value, return the list of places.

Here is the solution code:

[source, cypher]
----
MATCH (node:Place)
RETURN node.component_wcc, 
       count(*) as componentSize,
       collect(node.name) AS places
ORDER BY componentSize ASC
LIMIT 10
----

The results returned should look like this:

[.thumb]
image::EX2.5.png[EX2.5,width=400]

{nbsp} +

Notice that most of the nodes are in the same partition.

== Part 4: Execute the weighted Weakly connected component algorithm (Instructions/ Solution)

maybe add something?

[source, cypher]
----
CALL gds.wcc.stream('roads',{
    relationshipWeightProperty:'inverse_distance',
    threshold:0.2})
YIELD nodeId, componentId
RETURN componentId, 
       count(*) as component_size, 
       collect(gds.util.asNode(nodeId).name) as places
----

== Weakly Connected Components: Taking it further

. Try using different configuration values.
. Try using the stream version of the algorithm.

== Weakly Connected Components (Summary)

In this exercise, you gained some experience with writing Cypher for the weakly connected graph algorithms using the European Roads dataset.

